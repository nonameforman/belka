/*
 * jQuery liMarquee v 4.1
 *
 * Copyright 2013, Linnik Yura | LI MASS CODE | http://masscode.ru
 * http://masscode.ru/index.php/k2/item/44-limarquee
 * Free to use
 *
 * Last Update 09.02.2014
 */
(function ($) {
  var methods = {
    init: function (options) {
      var p = {
        direction: "left", //–£–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (left | right | up | down)
        loop: -1, //–ó–∞–¥–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –±—É–¥–µ—Ç –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞—Ç—å—Å—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ. "-1" –¥–ª—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏—è
        scrolldelay: 0, //–í–µ–ª–∏—á–∏–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∏ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö –º–µ–∂–¥—É –¥–≤–∏–∂–µ–Ω–∏—è–º–∏
        scrollamount: 50, //–°–∫–æ—Ä–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (px/sec)
        circular: true, //–ï—Å–ª–∏ "true" - —Å—Ç—Ä–æ–∫–∞ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è
        drag: true, //–ï—Å–ª–∏ "true" - –≤–∫–ª—é—á–µ–Ω–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏
        runshort: true, //–ï—Å–ª–∏ "true" - –∫–æ—Ä–æ—Ç–∫–∞—è —Å—Ç—Ä–æ–∫–∞ —Ç–æ–∂–µ "–±–µ–≥–∞–µ—Ç", "false" - —Å—Ç–æ–∏—Ç –Ω–∞ –º–µ—Å—Ç–µ
        hoverstop: true, //true - —Å—Ç—Ä–æ–∫–∞ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –∫—É—Ä—Å–æ—Ä–∞ –º—ã—à–∏, false - —Å—Ç—Ä–æ–∫–∞ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
        inverthover: false, //false - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ. –ï—Å–ª–∏ "true" - —Å—Ç—Ä–æ–∫–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç –¥–≤–∏–∂–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –∫—É—Ä—Å–æ—Ä–∞
        xml: false, //–ü—É—Ç—å –∫ xml —Ñ–∞–π–ª—É —Å –Ω—É–∂–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
      };

      if (options) {
        $.extend(p, options);
      }

      return this.each(function () {
        var enterEvent = "mouseenter";
        var leaveEvent = "mouseleave";
        if (p.inverthover) {
          enterEvent = "mouseleave";
          leaveEvent = "mouseenter";
        }

        var loop = p.loop,
          strWrap = $(this).addClass("str_wrap"),
          fMove = false;

        var code = function () {
          strWrap.off("mouseleave");
          strWrap.off("mouseenter");
          strWrap.off("mousemove");
          strWrap.off("mousedown");
          strWrap.off("mouseup");

          if (!$(".str_move", strWrap).length) {
            strWrap.wrapInner($("<div>").addClass("str_move"));
          }

          var strMove = $(".str_move", strWrap).addClass("str_origin"),
            strMoveClone = strMove
              .clone()
              .removeClass("str_origin")
              .addClass("str_move_clone"),
            time = 0;

          if (!p.hoverstop) {
            strWrap.addClass("noStop");
          }

          var circCloneHor = function () {
            strMoveClone
              .clone()
              .css({
                left: "100%",
                right: "auto",
                width: strMove.width(),
              })
              .appendTo(strMove);
            strMoveClone
              .css({
                right: "100%",
                left: "auto",
                width: strMove.width(),
              })
              .appendTo(strMove);
          };

          var circCloneVert = function () {
            strMoveClone
              .clone()
              .css({
                top: "100%",
                bottom: "auto",
                height: strMove.height(),
              })
              .appendTo(strMove);
            strMoveClone
              .css({
                bottom: "100%",
                top: "auto",
                height: strMove.height(),
              })
              .appendTo(strMove);
          };

          if (p.direction == "left") {
            strWrap.height(strMove.outerHeight());
            if (strMove.width() > strWrap.width()) {
              var leftPos = -strMove.width();

              if (p.circular) {
                if (!p.xml) {
                  circCloneHor();
                  leftPos = -(
                    strMove.width() +
                    (strMove.width() - strWrap.width())
                  );
                }
              }
              if (p.xml) {
                strMove.css({
                  left: strWrap.width(),
                });
              }
              var strMoveLeft = strWrap.width(),
                k1 = 0,
                timeFunc1 = function () {
                  var fullS = Math.abs(leftPos),
                    time = (fullS / p.scrollamount) * 1000;
                  if (parseFloat(strMove.css("left")) != 0) {
                    fullS = fullS + strWrap.width();
                    time =
                      ((fullS -
                        (strWrap.width() - parseFloat(strMove.css("left")))) /
                        p.scrollamount) *
                      1000;
                  }
                  return time;
                },
                moveFuncId1 = false,
                moveFunc1 = function () {
                  if (loop != 0) {
                    strMove.stop(true).animate(
                      {
                        left: leftPos,
                      },
                      timeFunc1(),
                      "linear",
                      function () {
                        $(this).css({
                          left: strWrap.width(),
                        });
                        if (loop == -1) {
                          moveFuncId1 = setTimeout(moveFunc1, p.scrolldelay);
                        } else {
                          loop--;
                          moveFuncId1 = setTimeout(moveFunc1, p.scrolldelay);
                        }
                      },
                    );
                  }
                };
              if (!p.inverthover) {
                moveFunc1();
              }

              if (p.hoverstop) {
                strWrap
                  .on(enterEvent, function () {
                    $(this).addClass("str_active");
                    clearTimeout(moveFuncId1);
                    strMove.stop(true);
                  })
                  .on("touchstart", function () {
                    $(this).addClass("str_active");
                    clearTimeout(moveFuncId1);
                    strMove.stop(true);
                  })
                  .on(leaveEvent, function () {
                    $(this).removeClass("str_active");
                    $(this).off("mousemove");
                    moveFunc1();
                  })
                  .on("touchend", function () {
                    $(this).removeClass("str_active");
                    $(this).off("mousemove");
                    moveFunc1();
                  });

                if (p.drag) {
                  strWrap.on("mousedown", function (e) {
                    if (p.inverthover) {
                      strMove.stop(true);
                    }
                    //drag
                    var dragLeft;
                    var dir;
                    var newX;
                    var oldX = e.clientX;
                    //drag

                    strMoveLeft = strMove.position().left;
                    k1 = strMoveLeft - (e.clientX - strWrap.offset().left);

                    $(this)
                      .on("mousemove", function (e) {
                        fMove = true;
                        //drag
                        newX = e.clientX;

                        if (newX > oldX) {
                          dir = 1;
                        } else {
                          dir = -1;
                        }
                        oldX = newX;
                        dragLeft = k1 + (e.clientX - strWrap.offset().left);
                        if (dragLeft < -strMove.width() && dir < 0) {
                          dragLeft = 0;
                          strMoveLeft = strMove.position().left;
                          k1 =
                            strMoveLeft - (e.clientX - strWrap.offset().left);
                        }
                        if (dragLeft > 0 && dir > 0) {
                          dragLeft = -strMove.width();
                          strMoveLeft = strMove.position().left;
                          k1 =
                            strMoveLeft - (e.clientX - strWrap.offset().left);
                        }
                        strMove.stop(true).css({
                          left: dragLeft,
                        });
                        //drag
                      })
                      .on("mouseup", function () {
                        $(this).off("mousemove");
                        if (p.inverthover) {
                          strMove.trigger("mouseenter");
                        }
                        setTimeout(function () {
                          fMove = false;
                        }, 50);
                      })
                      .on("click", function () {
                        if (fMove) {
                          return false;
                        }
                      });
                    return false;
                  });
                  strWrap.on("touchstart", function (e) {
                    if (p.inverthover) {
                      strMove.stop(true);
                    }
                    //drag
                    var dragLeft;
                    var dir;
                    var newX;
                    var oldX = e.originalEvent.touches[0].clientX;
                    //drag

                    strMoveLeft = strMove.position().left;
                    k1 = strMoveLeft - (oldX - strWrap.offset().left);

                    $(this)
                      .on("touchmove", function (e) {
                        fMove = true;
                        //drag
                        newX = e.originalEvent.touches[0].clientX;
                        console.log(
                          "üöÄ ~ file: jquery.liMarquee.min.js:263 ~ newX:",
                          newX,
                        );

                        if (newX > oldX) {
                          dir = 1;
                        } else {
                          dir = -1;
                        }
                        oldX = newX;
                        dragLeft = k1 + (newX - strWrap.offset().left);

                        if (dragLeft < -strMove.width() && dir < 0) {
                          dragLeft = 0;
                          strMoveLeft = strMove.position().left;
                          k1 = strMoveLeft - (newX - strWrap.offset().left);
                        }
                        if (dragLeft > 0 && dir > 0) {
                          dragLeft = -strMove.width();
                          strMoveLeft = strMove.position().left;
                          k1 = strMoveLeft - (newX - strWrap.offset().left);
                        }
                        strMove.stop(true).css({
                          left: dragLeft,
                        });
                        //drag
                      })
                      .on("mouseup", function () {
                        $(this).off("mousemove");
                        if (p.inverthover) {
                          strMove.trigger("mouseenter");
                        }
                        setTimeout(function () {
                          fMove = false;
                        }, 50);
                      })
                      .on("click", function () {
                        if (fMove) {
                          return false;
                        }
                      });
                    return false;
                  });
                } else {
                  strWrap.addClass("no_drag");
                }
              }
            } else {
              if (p.runshort) {
                strMove.css({
                  left: strWrap.width(),
                });
                var strMoveLeft = strWrap.width(),
                  k1 = 0,
                  timeFunc = function () {
                    time =
                      ((strMove.width() + strMove.position().left) /
                        p.scrollamount) *
                      1000;
                    return time;
                  };
                var moveFunc = function () {
                  var leftPos = -strMove.width();
                  strMove.animate(
                    {
                      left: leftPos,
                    },
                    timeFunc(),
                    "linear",
                    function () {
                      $(this).css({
                        left: strWrap.width(),
                      });
                      if (loop == -1) {
                        setTimeout(moveFunc, p.scrolldelay);
                      } else {
                        loop--;
                        setTimeout(moveFunc, p.scrolldelay);
                      }
                    },
                  );
                };
                if (!p.inverthover) {
                  moveFunc();
                }
                if (p.hoverstop) {
                  strWrap
                    .on(enterEvent, function () {
                      $(this).addClass("str_active");
                      strMove.stop(true);
                    })
                    .on(leaveEvent, function () {
                      $(this).removeClass("str_active");
                      $(this).off("mousemove");
                      moveFunc();
                    });

                  if (p.drag) {
                    strWrap.on("mousedown", function (e) {
                      if (p.inverthover) {
                        strMove.stop(true);
                      }
                      strMoveLeft = strMove.position().left;
                      k1 = strMoveLeft - (e.clientX - strWrap.offset().left);
                      $(this)
                        .on("mousemove", function (e) {
                          strMove.stop(true).css({
                            left: k1 + (e.clientX - strWrap.offset().left),
                          });
                        })
                        .on("mouseup", function () {
                          if (p.inverthover) {
                            strMove.trigger("mouseenter");
                          }
                          $(this).off("mousemove");
                        });
                      return false;
                    });
                  } else {
                    strWrap.addClass("no_drag");
                  }
                }
              } else {
                strWrap.addClass("str_static");
              }
            }
          }
          if (p.direction == "right") {
            strWrap.height(strMove.outerHeight());
            strWrap.addClass("str_right");
            strMove.css({
              left: -strMove.width(),
              right: "auto",
            });

            if (strMove.width() > strWrap.width()) {
              var leftPos = strWrap.width();
              strMove.css({
                left: 0,
              });
              if (p.circular) {
                if (!p.xml) {
                  circCloneHor();
                  //–û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫—Ä–∞–π–Ω—é—é —Ç–æ—á–∫—É
                  leftPos = strMove.width();
                }
              }

              var k2 = 0;
              timeFunc = function () {
                var fullS = strWrap.width(), //–∫—Ä–∞–π–Ω—è—è —Ç–æ—á–∫–∞
                  time = (fullS / p.scrollamount) * 1000; //–≤—Ä–µ–º—è
                if (parseFloat(strMove.css("left")) != 0) {
                  fullS = strMove.width() + strWrap.width();
                  time =
                    ((fullS -
                      (strMove.width() + parseFloat(strMove.css("left")))) /
                      p.scrollamount) *
                    1000;
                }
                return time;
              };
              var moveFunc = function () {
                if (loop != 0) {
                  strMove.animate(
                    {
                      left: leftPos,
                    },
                    timeFunc(),
                    "linear",
                    function () {
                      $(this).css({
                        left: -strMove.width(),
                      });
                      if (loop == -1) {
                        setTimeout(moveFunc, p.scrolldelay);
                      } else {
                        loop--;
                        setTimeout(moveFunc, p.scrolldelay);
                      }
                    },
                  );
                }
              };

              if (!p.inverthover) {
                moveFunc();
              }
              if (p.hoverstop) {
                strWrap
                  .on(enterEvent, function () {
                    $(this).addClass("str_active");
                    strMove.stop(true);
                  })
                  .on(leaveEvent, function () {
                    $(this).removeClass("str_active");
                    $(this).off("mousemove");
                    moveFunc();
                  });

                if (p.drag) {
                  strWrap
                    .on("mousedown", function (e) {
                      if (p.inverthover) {
                        strMove.stop(true);
                      }

                      //drag
                      var dragLeft;
                      var dir;
                      var newX;
                      var oldX = e.clientX;
                      //drag

                      strMoveLeft = strMove.position().left;
                      k2 = strMoveLeft - (e.clientX - strWrap.offset().left);
                      $(this).on("mousemove", function (e) {
                        //drag
                        newX = e.clientX;
                        if (newX > oldX) {
                          dir = 1;
                        } else {
                          dir = -1;
                        }
                        oldX = newX;
                        dragLeft = k2 + e.clientX - strWrap.offset().left;
                        if (dragLeft < -strMove.width() && dir < 0) {
                          dragLeft = 0;
                          strMoveLeft = strMove.position().left;
                          k2 =
                            strMoveLeft - (e.clientX - strWrap.offset().left);
                        }
                        if (dragLeft > 0 && dir > 0) {
                          dragLeft = -strMove.width();
                          strMoveLeft = strMove.position().left;
                          k2 =
                            strMoveLeft - (e.clientX - strWrap.offset().left);
                        }
                        strMove.stop(true).css({
                          left: dragLeft,
                        });
                        //drag
                      });
                      return false;
                    })
                    .on("mouseup", function () {
                      if (p.inverthover) {
                        strMove.trigger("mouseenter");
                      }
                      $(this).off("mousemove");
                    });
                } else {
                  strWrap.addClass("no_drag");
                }
              }
            } else {
              if (p.runshort) {
                var k2 = 0;
                var timeFunc = function () {
                  time =
                    ((strWrap.width() - strMove.position().left) /
                      p.scrollamount) *
                    1000;
                  return time;
                };
                var moveFunc = function () {
                  var leftPos = strWrap.width();
                  strMove.animate(
                    {
                      left: leftPos,
                    },
                    timeFunc(),
                    "linear",
                    function () {
                      $(this).css({
                        left: -strMove.width(),
                      });
                      if (loop == -1) {
                        setTimeout(moveFunc, p.scrolldelay);
                      } else {
                        loop--;
                        setTimeout(moveFunc, p.scrolldelay);
                      }
                    },
                  );
                };

                if (!p.inverthover) {
                  moveFunc();
                }
                if (p.hoverstop) {
                  strWrap
                    .on(enterEvent, function () {
                      $(this).addClass("str_active");
                      strMove.stop(true);
                    })
                    .on(leaveEvent, function () {
                      $(this).removeClass("str_active");
                      $(this).off("mousemove");
                      moveFunc();
                    });

                  if (p.drag) {
                    strWrap
                      .on("mousedown", function (e) {
                        if (p.inverthover) {
                          strMove.stop(true);
                        }
                        strMoveLeft = strMove.position().left;
                        k2 = strMoveLeft - (e.clientX - strWrap.offset().left);
                        $(this).on("mousemove", function (e) {
                          strMove.stop(true).css({
                            left: k2 + e.clientX - strWrap.offset().left,
                          });
                        });
                        return false;
                      })
                      .on("mouseup", function () {
                        if (p.inverthover) {
                          strMove.trigger("mouseenter");
                        }
                        $(this).off("mousemove");
                      });
                  } else {
                    strWrap.addClass("no_drag");
                  }
                }
              } else {
                strWrap.addClass("str_static");
              }
            }
          }
          if (p.direction == "up") {
            strWrap.addClass("str_vertical");

            if (strMove.height() > strWrap.height()) {
              var topPos = -strMove.height();
              if (p.circular) {
                if (!p.xml) {
                  circCloneVert();
                  topPos = -(
                    strMove.height() +
                    (strMove.height() - strWrap.height())
                  );
                }
              }
              if (p.xml) {
                strMove.css({
                  top: strWrap.height(),
                });
              }
              var k2 = 0;
              timeFunc = function () {
                var fullS = Math.abs(topPos),
                  time = (fullS / p.scrollamount) * 1000;
                if (parseFloat(strMove.css("top")) != 0) {
                  fullS = fullS + strWrap.height();
                  time =
                    ((fullS -
                      (strWrap.height() - parseFloat(strMove.css("top")))) /
                      p.scrollamount) *
                    1000;
                }

                return time;
              };
              var moveFunc = function () {
                if (loop != 0) {
                  strMove.animate(
                    {
                      top: topPos,
                    },
                    timeFunc(),
                    "linear",
                    function () {
                      $(this).css({
                        top: strWrap.height(),
                      });
                      if (loop == -1) {
                        setTimeout(moveFunc, p.scrolldelay);
                      } else {
                        loop--;
                        setTimeout(moveFunc, p.scrolldelay);
                      }
                    },
                  );
                }
              };
              if (!p.inverthover) {
                moveFunc();
              }
              if (p.hoverstop) {
                strWrap
                  .on(enterEvent, function () {
                    $(this).addClass("str_active");
                    strMove.stop(true);
                  })
                  .on(leaveEvent, function () {
                    $(this).removeClass("str_active");
                    $(this).off("mousemove");
                    moveFunc();
                  });

                if (p.drag) {
                  strWrap
                    .on("mousedown", function (e) {
                      if (p.inverthover) {
                        strMove.stop(true);
                      }

                      //drag
                      var dragTop;
                      var dir;
                      var newY;
                      var oldY = e.clientY;
                      //drag

                      strMoveTop = strMove.position().top;
                      k2 = strMoveTop - (e.clientY - strWrap.offset().top);
                      $(this).on("mousemove", function (e) {
                        //drag
                        newY = e.clientY;
                        if (newY > oldY) {
                          dir = 1;
                        } else {
                          dir = -1;
                        }
                        oldY = newY;
                        dragTop = k2 + e.clientY - strWrap.offset().top;
                        if (dragTop < -strMove.height() && dir < 0) {
                          dragTop = 0;
                          strMoveTop = strMove.position().top;
                          k2 = strMoveTop - (e.clientY - strWrap.offset().top);
                        }
                        if (dragTop > 0 && dir > 0) {
                          dragTop = -strMove.height();
                          strMoveTop = strMove.position().top;
                          k2 = strMoveTop - (e.clientY - strWrap.offset().top);
                        }
                        strMove.stop(true).css({
                          top: dragTop,
                        });
                        //drag
                      });
                      return false;
                    })
                    .on("mouseup", function () {
                      if (p.inverthover) {
                        strMove.trigger("mouseenter");
                      }
                      $(this).off("mousemove");
                    });
                } else {
                  strWrap.addClass("no_drag");
                }
              }
            } else {
              if (p.runshort) {
                strMove.css({
                  top: strWrap.height(),
                });
                var k2 = 0;
                var timeFunc = function () {
                  time =
                    ((strMove.height() + strMove.position().top) /
                      p.scrollamount) *
                    1000;

                  return time;
                };
                var moveFunc = function () {
                  var topPos = -strMove.height();
                  strMove.animate(
                    {
                      top: topPos,
                    },
                    timeFunc(),
                    "linear",
                    function () {
                      $(this).css({
                        top: strWrap.height(),
                      });
                      if (loop == -1) {
                        setTimeout(moveFunc, p.scrolldelay);
                      } else {
                        loop--;
                        setTimeout(moveFunc, p.scrolldelay);
                      }
                    },
                  );
                };
                if (!p.inverthover) {
                  moveFunc();
                }
                if (p.hoverstop) {
                  strWrap
                    .on(enterEvent, function () {
                      $(this).addClass("str_active");
                      strMove.stop(true);
                    })
                    .on(leaveEvent, function () {
                      $(this).removeClass("str_active");
                      $(this).off("mousemove");
                      moveFunc();
                    });

                  if (p.drag) {
                    strWrap
                      .on("mousedown", function (e) {
                        if (p.inverthover) {
                          strMove.stop(true);
                        }
                        strMoveTop = strMove.position().top;
                        k2 = strMoveTop - (e.clientY - strWrap.offset().top);
                        $(this).on("mousemove", function (e) {
                          strMove.stop(true).css({
                            top: k2 + e.clientY - strWrap.offset().top,
                          });
                        });
                        return false;
                      })
                      .on("mouseup", function () {
                        if (p.inverthover) {
                          strMove.trigger("mouseenter");
                        }
                        $(this).off("mousemove");
                      });
                  } else {
                    strWrap.addClass("no_drag");
                  }
                }
              } else {
                strWrap.addClass("str_static");
              }
            }
          }
          if (p.direction == "down") {
            strWrap.addClass("str_vertical").addClass("str_down");
            strMove.css({
              top: -strMove.height(),
              bottom: "auto",
            });
            if (strMove.height() > strWrap.height()) {
              var topPos = strWrap.height();
              if (p.circular) {
                if (!p.xml) {
                  circCloneVert();
                  topPos = strMove.height();
                }
              }
              if (p.xml) {
                strMove.css({
                  top: -strMove.height(),
                });
              }
              var k2 = 0;
              timeFunc = function () {
                var fullS = strWrap.height(), //–∫—Ä–∞–π–Ω—è—è —Ç–æ—á–∫–∞
                  time = (fullS / p.scrollamount) * 1000; //–≤—Ä–µ–º—è

                if (parseFloat(strMove.css("top")) != 0) {
                  fullS = strMove.height() + strWrap.height();
                  time =
                    ((fullS -
                      (strMove.height() + parseFloat(strMove.css("top")))) /
                      p.scrollamount) *
                    1000;
                }
                return time;
              };
              var moveFunc = function () {
                if (loop != 0) {
                  strMove.animate(
                    {
                      top: topPos,
                    },
                    timeFunc(),
                    "linear",
                    function () {
                      $(this).css({
                        top: -strMove.height(),
                      });
                      if (loop == -1) {
                        setTimeout(moveFunc, p.scrolldelay);
                      } else {
                        loop--;
                        setTimeout(moveFunc, p.scrolldelay);
                      }
                    },
                  );
                }
              };
              if (!p.inverthover) {
                moveFunc();
              }
              if (p.hoverstop) {
                strWrap
                  .on(enterEvent, function () {
                    $(this).addClass("str_active");
                    strMove.stop(true);
                  })
                  .on(leaveEvent, function () {
                    $(this).removeClass("str_active");
                    $(this).off("mousemove");
                    moveFunc();
                  });

                if (p.drag) {
                  strWrap
                    .on("mousedown", function (e) {
                      if (p.inverthover) {
                        strMove.stop(true);
                      }

                      //drag
                      var dragTop;
                      var dir;
                      var newY;
                      var oldY = e.clientY;
                      //drag

                      strMoveTop = strMove.position().top;
                      k2 = strMoveTop - (e.clientY - strWrap.offset().top);
                      $(this).on("mousemove", function (e) {
                        //drag
                        newY = e.clientY;
                        if (newY > oldY) {
                          dir = 1;
                        } else {
                          dir = -1;
                        }
                        oldY = newY;
                        dragTop = k2 + e.clientY - strWrap.offset().top;
                        if (dragTop < -strMove.height() && dir < 0) {
                          dragTop = 0;
                          strMoveTop = strMove.position().top;
                          k2 = strMoveTop - (e.clientY - strWrap.offset().top);
                        }
                        if (dragTop > 0 && dir > 0) {
                          dragTop = -strMove.height();
                          strMoveTop = strMove.position().top;
                          k2 = strMoveTop - (e.clientY - strWrap.offset().top);
                        }
                        strMove.stop(true).css({
                          top: dragTop,
                        });
                        //drag
                      });
                      return false;
                    })
                    .on("mouseup", function () {
                      if (p.inverthover) {
                        strMove.trigger("mouseenter");
                      }
                      $(this).off("mousemove");
                    });
                } else {
                  strWrap.addClass("no_drag");
                }
              }
            } else {
              if (p.runshort) {
                var k2 = 0;
                var timeFunc = function () {
                  time =
                    ((strWrap.height() - strMove.position().top) /
                      p.scrollamount) *
                    1000;
                  return time;
                };
                var moveFunc = function () {
                  var topPos = strWrap.height();
                  strMove.animate(
                    {
                      top: topPos,
                    },
                    timeFunc(),
                    "linear",
                    function () {
                      $(this).css({
                        top: -strMove.height(),
                      });
                      if (loop == -1) {
                        setTimeout(moveFunc, p.scrolldelay);
                      } else {
                        loop--;
                        setTimeout(moveFunc, p.scrolldelay);
                      }
                    },
                  );
                };
                if (!p.inverthover) {
                  moveFunc();
                }
                if (p.hoverstop) {
                  strWrap
                    .on(enterEvent, function () {
                      $(this).addClass("str_active");
                      strMove.stop(true);
                    })
                    .on(leaveEvent, function () {
                      $(this).removeClass("str_active");
                      $(this).off("mousemove");
                      moveFunc();
                    });

                  if (p.drag) {
                    strWrap
                      .on("mousedown", function (e) {
                        if (p.inverthover) {
                          strMove.stop(true);
                        }
                        strMoveTop = strMove.position().top;
                        k2 = strMoveTop - (e.clientY - strWrap.offset().top);
                        $(this).on("mousemove", function (e) {
                          strMove.stop(true).css({
                            top: k2 + e.clientY - strWrap.offset().top,
                          });
                        });
                        return false;
                      })
                      .on("mouseup", function () {
                        if (p.inverthover) {
                          strMove.trigger("mouseenter");
                        }
                        $(this).off("mousemove");
                      });
                  } else {
                    strWrap.addClass("no_drag");
                  }
                }
              } else {
                strWrap.addClass("str_static");
              }
            }
          }
        };
        if (p.xml) {
          $.ajax({
            url: p.xml,
            dataType: "xml",
            success: function (xml) {
              var xmlTextEl = $(xml).find("text");
              var xmlTextLength = xmlTextEl.length;
              for (var i = 0; i < xmlTextLength; i++) {
                var xmlElActive = xmlTextEl.eq(i);
                var xmlElContent = xmlElActive.text();
                var xmlItemEl = $("<span>")
                  .text(xmlElContent)
                  .appendTo(strWrap);

                if (p.direction == "left" || p.direction == "right") {
                  xmlItemEl.css({display: "inline-block", textAlign: "right"});
                  if (i > 0) {
                    xmlItemEl.css({width: strWrap.width() + xmlItemEl.width()});
                  }
                }
                if (p.direction == "down" || p.direction == "up") {
                  xmlItemEl.css({display: "block", textAlign: "left"});
                  if (i > 0) {
                    xmlItemEl.css({paddingTop: strWrap.height()});
                  }
                }
              }
              code();
            },
          });
        } else {
          code();
        }
        strWrap.data({
          ini: code,
        });
      });
    },

    update: function () {
      var el = $(this);
      var str_origin = $(".str_origin", el);
      var str_move_clone = $(".str_move_clone", el);
      str_origin.stop(true);
      str_move_clone.remove();
      el.data("ini")();
    },
  };
  $.fn.liMarquee = function (method) {
    if (methods[method]) {
      return methods[method].apply(
        this,
        Array.prototype.slice.call(arguments, 1),
      );
    } else if (typeof method === "object" || !method) {
      return methods.init.apply(this, arguments);
    } else {
      $.error("–ú–µ—Ç–æ–¥ " + method + " –≤ jQuery.liMarquee –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç");
    }
  };
})(jQuery);
